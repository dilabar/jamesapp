


{% extends 'new/base.html' %}
{% load static %}

{% block header %}

{% endblock header %}

{% block css %}
<link rel="stylesheet" type="text/css" href="{% static 'manish/css/vendors/datatables.css' %}">
{% endblock css %}
    


{% block body %}

<div class="page-body">
    <div class="container-fluid">
      <div class="page-title">
        <div class="row">
          <div class="col-6">
            <h4></h4>
          </div>
          <div class="col-6">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="#">                                       
                  <svg class="stroke-icon">
                    <use href="{% static 'manish/svg/icon-sprite.svg' %}#stroke-home"></use>
                  </svg></a></li>
              <li class="breadcrumb-item">Call History</li>
              <li class="breadcrumb-item active">{{call_obj.agnt.description}} </li>
            </ol>
          </div>
        </div>
      </div>
    </div>
   
    <!-- Container-fluid starts-->
    <div class="container-fluid">
        <div class="email-wrap bookmark-wrap">
          <div class="row">
            <div class="col-xl-3 box-col-6">
              <div class="md-sidebar"><a class="btn btn-primary md-sidebar-toggle" href="javascript:void(0)">Add Notes</a>
                <div class="md-sidebar-aside job-left-aside custom-scrollbar">
                  <div class="email-left-aside">
                    <div class="card">
                      <div class="card-body">
                        <div class="email-app-sidebar left-bookmark">
                          <div class="media">
                            <div class="media-size-email"><img class="me-3 rounded-circle" src="{% static 'manish/images/user/user.png' %}" alt=""></div>
                            <div class="media-body">
                              <h6 class="f-w-600">{{call_obj.agnt.description|capfirst|default:"NA" }}</h6>
                              <!-- <p>Markjecno@gmail.com</p> -->
                            </div>
                          </div>
                          <ul class="nav main-menu" role="tablist">
                            <li class="nav-item">
                              {% comment %} <button class="btn-primary btn-block btn-mail w-100" 
                              type="button" data-bs-toggle="modal" data-bs-target="#exampleModal">
                              <i class="me-2" data-feather="bookmark"></i> Add Remarks  </button> {% endcomment %}
                            </li>
                            <!-- <li class="nav-item"> <span class="main-title f-w-500"> Views </span></li> -->
                            <li> <a class="active" id="pills-created-tab" data-bs-toggle="pill" href="#pills-created" role="tab" aria-controls="pills-created" 
                                aria-selected="true"><span class="title f-w-400"> Call Details</span></a></li>
                            <li><a id="pills-favourites-tab" data-bs-toggle="pill" href="#pills-favourites" role="tab" aria-controls="pills-favourites" 
                                aria-selected="false"><span class="title f-w-400"> Conversation Log</span></a></li>
                                <li><a id="pills-call-summary-tab" data-bs-toggle="pill" href="#pills-call-summary" role="tab" aria-controls="pills-call-summary" 
                                  aria-selected="false"><span class="title f-w-400"> Call Summary</span></a></li>
                          
                           
                            <li> 
                              <hr>
                            </li>
                            {% comment %} <li><span class="main-title f-w-500"> Tags<span class="pull-right">
                                <a href="#" data-bs-toggle="modal" data-bs-target="#createtag">
                                    <i data-feather="plus-circle"></i></a></span></span></li> {% endcomment %}
                        
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>


            <div class="col-xl-9 col-md-12 box-col-12">
              <div class="email-right-aside bookmark-tabcontent">
                <div class="card email-body radius-left">
                  <div class="ps-0">
                    <div class="tab-content">
                
                
                     {% include 'new/components/customer_card.html' %}
                     {% include 'new/components/customer_log.html' %}
                     {% include 'new/components/customer_summary.html' %}
              
                     

                    
                     
                    


                      <div class="modal fade modal-bookmark" id="edit-bookmark" tabindex="-1" role="dialog" aria-hidden="true">
                        <div class="modal-dialog modal-lg" role="document">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h5 class="modal-title">Edit Bookmark</h5>
                              <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                              <form class="form-bookmark needs-validation" novalidate="">
                                <div class="row g-2">
                                  <div class="mb-3 mt-0 col-md-12">
                                    <label>Web Url</label>
                                    <input class="form-control" id="editurl" type="text" required="" autocomplete="off" value="http://admin.pixelstrap.com/Riho/ltr/landing-page.html">
                                  </div>
                                  <div class="mb-3 mt-0 col-md-12">
                                    <label>Title</label>
                                    <input class="form-control" id="edittitle" type="text" required="" autocomplete="off" value="Admin Template">
                                  </div>
                                  <div class="mb-3 mt-0 col-md-12">
                                    <label>Description</label>
                                    <textarea class="form-control" id="editdesc" required="" autocomplete="off">Riho is beautifully crafted, clean and modern designed admin theme with 6 different demos and light - dark versions.</textarea>
                                  </div>
                                  <div class="mb-3 mt-0 col-md-6">
                                    <label>Group</label>
                                    <select class="js-example-basic-single">
                                      <option value="AL">My Bookmarks</option>
                                    </select>
                                  </div>
                                  <div class="mb-3 mt-0 col-md-6">
                                    <label>Collection</label>
                                    <select class="js-example-disabled-results">
                                      <option value="general">General</option>
                                      <option value="fs">fs</option>
                                    </select>
                                  </div>
                                </div>
                                <button class="btn btn-secondary" type="button">Save</button>
                                <button class="btn btn-primary" type="button" data-bs-dismiss="modal">Cancel   </button>
                              </form>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="modal fade modal-bookmark" id="createtag" tabindex="-1" role="dialog" aria-hidden="true">
                        <div class="modal-dialog modal-lg" role="document">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h4>.modal-title.f-w-500 Create Tag</h4>
                              <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                              <form class="form-bookmark needs-validation" novalidate="">
                                <div class="row g-2">
                                  <div class="mb-3 mt-0 col-md-12">
                                    <label>Tag Name</label>
                                    <input class="form-control" type="text" required="" autocomplete="off">
                                  </div>
                                  <div class="mb-3 mt-0 col-md-12">
                                    <label>Tag color</label>
                                    <input class="form-color d-block" type="color" value="#006666">
                                  </div>
                                </div>
                                <button class="btn btn-secondary" type="button">Save</button>
                                <button class="btn btn-primary" type="button" data-bs-dismiss="modal">Cancel</button>
                              </form>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="modal fade modal-bookmark" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg" role="document">
                          <div class="modal-content"> 
                            <div class="modal-header"> 
                              <h5 class="modal-title" id="exampleModalLabel">Add Bookmark</h5>
                              <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                              <form class="form-bookmark needs-validation" id="bookmark-form" novalidate="">
                                <div class="row g-2">
                                  <div class="mb-3 mt-0 col-md-12">
                                    <label for="bm-weburl">Web Url</label>
                                    <input class="form-control" id="bm-weburl" type="text" required="" autocomplete="off">
                                  </div>
                                  <div class="mb-3 mt-0 col-md-12">
                                    <label for="bm-title">Title</label>
                                    <input class="form-control" id="bm-title" type="text" required="" autocomplete="off">
                                  </div>
                                  <div class="mb-3 mt-0 col-md-12">
                                    <label>Description</label>
                                    <textarea class="form-control" id="bm-desc" required="" autocomplete="off"></textarea>
                                  </div>
                                  <div class="mb-3 mt-0 col-md-6">
                                    <label>Group</label>
                                    <select class="js-example-basic-single" id="bm-group">
                                      <option value="bookmark">My Bookmarks</option>
                                    </select>
                                  </div>
                                  <div class="mb-3 mt-0 col-md-6">
                                    <label>Collection</label>
                                    <select class="js-example-disabled-results" id="bm-collection">
                                      <option value="general">General</option>
                                      <option value="fs">fs</option>
                                    </select>
                                  </div>
                                </div>
                                <input id="index_var" type="hidden" value="6">
                                <button class="btn btn-secondary" id="Bookmark" onclick="submitBookMark()" type="submit">Save</button>
                                <button class="btn btn-primary" type="button" data-bs-dismiss="modal">Cancel</button>
                              </form>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Container-fluid Ends-->

</div>            

{% endblock body %}
    


{% block js %}
<script src="{% static 'manish/js/datatable/datatables/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'manish/js/datatable/datatables/datatable.custom.js' %}"></script>

<script>
  function analyzeCall() {
      const summaryBox = $("#callSummary");
      const summaryText = $("#aiSummary");

      // Show the summary box and update text
      summaryBox.removeClass("d-none");
      summaryText.text("Processing...");

      $.ajax({
          url: "{% url 'agent:analyze_call_summary' %}",
          type: "POST",
          headers: {
              "X-CSRFToken": getCookie("csrftoken")
          },
          data: JSON.stringify({
              call_id: {{ call_obj.id }}
          }),
          contentType: "application/json",
          success: function(response) {
              summaryText.text(response.summary);
          },
          error: function(xhr, status, error) {
              summaryText.text("An error occurred during analysis.");
              console.error("Error:", error);
          }
      });
  }

  // Get CSRF token from cookie
  function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== "") {
          const cookies = document.cookie.split(';');
          for (let i = 0; i < cookies.length; i++) {
              const cookie = cookies[i].trim();
              if (cookie.substring(0, name.length + 1) === (name + '=')) {
                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                  break;
              }
          }
      }
      return cookieValue;
  }
</script>

{% endblock js %}
    
